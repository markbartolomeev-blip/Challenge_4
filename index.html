<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TulenmasCandy Box</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:Arial, sans-serif;
  user-select:none;
  overflow:hidden;
}

#top{
  text-align:center;
  font-size:26px;
  padding:10px;
}

#hearts{
  position:fixed;
  left:10px;
  top:80px;
  font-size:24px;
}

#box{
  position:relative;
  margin:50px auto 0;
  width:90vw;
  max-width:420px;
  height:55vh;
  border:4px solid #fff;
  border-radius:20px;
  background:#1a1a1a;
  overflow:hidden;
}

.candy{
  position:absolute;
  width:26px;
  pointer-events:none;
}

#controls{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  text-align:center;
}

#stopBtn{
  width:100px;
  height:100px;
  border-radius:50%;
  border:none;
  background:red;
  color:#fff;
  font-size:18px;
  font-weight:bold;
}

#counter{
  margin-top:8px;
  font-size:18px;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.88);
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  z-index:10;
}

.box{
  padding:20px;
  font-size:18px;
}

button{
  padding:12px 22px;
  border:none;
  border-radius:12px;
  font-size:16px;
}
</style>
</head>

<body>

<!-- –ó–ê–ì–†–£–ó–ö–ê -->
<div class="overlay" id="loading">
  <div class="box">
    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ TulenmasCandy‚Ä¶ üç¨</h2>
  </div>
</div>

<div id="top">üïê üïê üïê</div>
<div id="hearts"></div>

<div id="box"></div>

<div id="controls">
  <button id="stopBtn">–°–¢–û–ü</button>
  <div id="counter">
    <span id="current">0</span> /
    <span id="goal">0</span>
  </div>
</div>

<!-- –û–ë–£–ß–ï–ù–ò–ï -->
<div class="overlay" id="tutorial" style="display:none">
  <div class="box">
    <h2>üì¶ TulenmasCandy Box</h2>
    <p>
      –û—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ—Ç–æ–∫ –∫–æ–Ω—Ñ–µ—Ç üç¨<br><br>
      –ù—É–∂–Ω–æ –ø–æ–ø–∞—Å—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω<br>
      <b>¬±3 –æ—Ç —Ü–µ–ª–∏</b><br><br>
      5 –æ—à–∏–±–æ–∫ ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞–≤—Å–µ–≥–¥–∞.
    </p>
    <button onclick="startGame()">–ü–æ–Ω—è—Ç–Ω–æ</button>
  </div>
</div>

<!-- –û–í–ï–†–õ–ï–ô -->
<div class="overlay" id="overlay" style="display:none">
  <div class="box" id="overlayText"></div>
</div>

<script>
const candyImg = "0D1FE365-BEBC-45DE-B474-68D1B195F3AC.png";

/* üîí –ë–õ–û–ö–ò–†–û–í–ö–ê */
if(localStorage.getItem("tulen_blocked")){
  document.body.innerHTML = `
    <div class="overlay">
      <div class="box">
        <h2>‚õî –î–û–°–¢–£–ü –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù</h2>
        <p>–¢—é–ª–µ–Ω—å –Ω–µ–¥–æ–≤–æ–ª–µ–Ω ü¶≠üíî</p>
      </div>
    </div>`;
}

/* –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê */
const preload = new Image();
preload.src = candyImg;
preload.onload = ()=>{
  document.getElementById("loading").style.display="none";
  document.getElementById("tutorial").style.display="flex";
};

/* –°–õ–û–ñ–ù–û–°–¢–ò */
const levels = [
  {speed:650, streams:1, min:20, max:40},
  {speed:380, streams:2, min:50, max:80},
  {speed:200, streams:3, min:80, max:120}
];

let level = 0;
let hearts = 5;
let goal = 0;
let count = 0;
let running = false;
let interval;
let progress = ["üïê","üïê","üïê"];

const box = document.getElementById("box");
const heartsEl = document.getElementById("hearts");
const topEl = document.getElementById("top");
const goalEl = document.getElementById("goal");
const currentEl = document.getElementById("current");
const overlay = document.getElementById("overlay");
const overlayText = document.getElementById("overlayText");

function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function updateUI(){
  heartsEl.textContent = "‚ù§Ô∏è".repeat(hearts);
  topEl.textContent = progress.join(" ");
  goalEl.textContent = goal;
  currentEl.textContent = count;
}

function startGame(){
  document.getElementById("tutorial").style.display="none";
  startLevel();
}

function startLevel(){
  const l = levels[level];
  goal = rand(l.min, l.max);
  count = 0;
  running = true;
  box.innerHTML="";
  updateUI();

  interval = setInterval(()=>{
    for(let i=0;i<l.streams;i++) dropCandy();
  }, l.speed);
}

/* üç¨ –ü–ê–î–ï–ù–ò–ï –ò –°–¢–ê–ö */
function dropCandy(){
  if(!running) return;

  const candy = document.createElement("img");
  candy.src = candyImg;
  candy.className = "candy";

  const size = 26;
  let x = rand(10, box.clientWidth - size - 10);
  let y = -size;

  candy.style.left = x+"px";
  candy.style.top = y+"px";
  box.appendChild(candy);

  const fall = setInterval(()=>{
    y += 5;
    let stop = false;

    if(y + size >= box.clientHeight){
      y = box.clientHeight - size;
      stop = true;
    }

    document.querySelectorAll(".candy").forEach(o=>{
      if(o===candy) return;
      const oy = parseFloat(o.style.top);
      const ox = parseFloat(o.style.left);
      const overlapX = x < ox+size && x+size > ox;
      const touchY = y+size >= oy && y+size <= oy+6;
      if(overlapX && touchY){
        y = oy - size;
        stop = true;
      }
    });

    candy.style.top = y+"px";
    if(stop) clearInterval(fall);
  },16);

  count++;
  currentEl.textContent = count;
}

function stopGame(){
  if(!running) return;
  running=false;
  clearInterval(interval);

  if(Math.abs(count - goal) <= 3){
    progress[level] = "‚úÖ";
    level++;

    if(level === 3){
      overlay.style.display="flex";
      overlayText.innerHTML = `
        <h2>üéâ –ü–û–ë–ï–î–ê</h2>
        <p>–í—Å–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ã ‚úÖ‚úÖ‚úÖ</p>`;
    }else{
      showOverlay("–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–π–¥–µ–Ω–∞ ‚úÖ", startLevel);
    }
  }else{
    hearts--;
    if(hearts <= 0){
      localStorage.setItem("tulen_blocked","1");
      location.reload();
    }else{
      showOverlay("–û—à–∏–±–∫–∞ üíî", startLevel);
    }
  }
}

function showOverlay(text, cb){
  overlay.style.display="flex";
  overlayText.innerHTML = `<p>${text}</p>`;
  setTimeout(()=>{
    overlay.style.display="none";
    cb();
  },1200);
}

document.getElementById("stopBtn").onclick = stopGame;
updateUI();
</script>

</body>
</html>
