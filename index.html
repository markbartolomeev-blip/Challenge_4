<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TulenmasCandy Conveyor</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#000;
  overflow:hidden;
  user-select:none;
}

#bg{
  position:fixed;
  inset:0;
  background:url("0864A2E3-E668-43BB-ABE0-5D62B44467FC.jpeg") center/cover no-repeat;
  z-index:-2;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  z-index:10;
}

.box{
  padding:20px;
  font-size:18px;
  max-width:90%;
}

#game{
  position:relative;
  width:100%;
  height:100vh;
}

#conveyor{
  position:absolute;
  top:40%;
  left:5%;
  width:90%;
  height:100px;
  background:#777;
  border-radius:20px;
  overflow:hidden;
}

#zone{
  position:absolute;
  top:40%;
  left:50%;
  transform:translateX(-50%);
  width:90px;
  height:90px;
  border:3px solid #fff;
  pointer-events:none;
}

.candy{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  height:40px;
}

#fist{
  position:absolute;
  top:30%;
  left:50%;
  transform:translateX(-50%);
  width:90px;
  pointer-events:none;
  transition:transform .1s;
}

#controls{
  position:absolute;
  bottom:30px;
  width:100%;
  text-align:center;
}

#punchBtn{
  width:120px;
  height:120px;
  border-radius:50%;
  border:none;
  background:#c00;
  color:#fff;
  font-size:18px;
  font-weight:bold;
}

#counter{
  margin-top:10px;
  color:#fff;
  font-size:18px;
}
</style>
</head>

<body>

<div id="bg"></div>

<!-- –ó–ê–ì–†–£–ó–ö–ê -->
<div class="overlay" id="loading">
  <div class="box">
    <h2>–ó–∞–≥—Ä—É–∑–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤‚Ä¶</h2>
  </div>
</div>

<!-- –û–ë–£–ß–ï–ù–ò–ï -->
<div class="overlay" id="tutorial" style="display:none">
  <div class="box">
    <h2>–û–±—É—á–µ–Ω–∏–µ üëä</h2>
    <p>
      –ü–æ –∫–æ–Ω–≤–µ–π–µ—Ä—É –µ–¥—É—Ç –∫–æ–Ω—Ñ–µ—Ç—ã üç¨<br><br>
      –ö–æ–≥–¥–∞ <b>–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è</b> –∫–æ–Ω—Ñ–µ—Ç–∞<br>
      –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–µ–ª–æ–π –∑–æ–Ω–µ ‚¨ú<br>
      –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –≤—ã–±–∏—Ç—å –µ—ë.<br><br>
      <b>–ó–∞–¥–∞—á–∞:</b> –≤—ã–±–∏—Ç—å 50 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–µ—Ç
    </p>
    <button onclick="startTutorial()">–ù–∞—á–∞—Ç—å</button>
  </div>
</div>

<div id="game" style="display:none">
  <img id="fist" src="E83F4545-0152-4EEE-B616-9817D1655B1C.png">
  <div id="conveyor"></div>
  <div id="zone"></div>

  <div id="controls">
    <button id="punchBtn">–£–î–ê–†</button>
    <div id="counter">0 / 50</div>
  </div>
</div>

<script>
const goodCandy = "0D1FE365-BEBC-45DE-B474-68D1B195F3AC.png";
const badCandies = [
  "12B84A29-F10D-4B79-93F0-34E6B12E4AA4.png",
  "AE95D2B0-7B3F-40F7-A6AA-B03876A18AB4.png"
];

const images = [
  "0864A2E3-E668-43BB-ABE0-5D62B44467FC.jpeg",
  "E83F4545-0152-4EEE-B616-9817D1655B1C.png",
  goodCandy,
  ...badCandies
];

let speed = 1.5;
let tutorialHits = 0;
let startTime = null;
let candies = [];

const conveyor = document.getElementById("conveyor");
const zone = document.getElementById("zone");
const fist = document.getElementById("fist");
const counter = document.getElementById("counter");

/* –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê */
let loaded = 0;
images.forEach(src=>{
  const i = new Image();
  i.src = src;
  i.onload = ()=>{
    loaded++;
    if(loaded === images.length){
      document.getElementById("loading").style.display="none";
      document.getElementById("tutorial").style.display="flex";
    }
  };
});

function startTutorial(){
  document.getElementById("tutorial").style.display="none";
  document.getElementById("game").style.display="block";
  startTime = Date.now();
  loop();
  spawnLoop();
}

function spawnLoop(){
  setInterval(spawnCandy, 1200);
}

function spawnCandy(){
  const img = document.createElement("img");
  const bad = Math.random()<0.4;
  img.src = bad ? badCandies[Math.floor(Math.random()*badCandies.length)] : goodCandy;
  img.className="candy";
  img.dataset.bad = bad?"1":"0";
  img.style.left = "-50px";
  conveyor.appendChild(img);
  candies.push(img);
}

function loop(){
  const now = Date.now();
  const elapsed = (now - startTime)/1000;

  if(elapsed>10) speed=2;
  if(elapsed>30) speed=2.7;
  if(elapsed>60) speed=3.5;

  candies.forEach((c,i)=>{
    let x = parseFloat(c.style.left);
    x += speed;
    c.style.left = x+"px";

    if(x > conveyor.clientWidth){
      if(c.dataset.bad==="1"){
        // –ø—Ä–æ–ø—É—Å—Ç–∏–ª –ø–ª–æ—Ö—É—é
        tutorialHits = Math.max(0, tutorialHits-1);
        counter.textContent = tutorialHits+" / 50";
      }
      c.remove();
      candies.splice(i,1);
    }
  });

  requestAnimationFrame(loop);
}

document.getElementById("punchBtn").onclick = ()=>{
  fist.style.transform="translateX(-50%) translateY(20px)";
  setTimeout(()=>fist.style.transform="translateX(-50%)",100);

  const zoneRect = zone.getBoundingClientRect();

  candies.forEach((c,i)=>{
    const r = c.getBoundingClientRect();
    if(r.left>zoneRect.left && r.right<zoneRect.right){
      if(c.dataset.bad==="1"){
        tutorialHits++;
        counter.textContent = tutorialHits+" / 50";
        c.remove();
        candies.splice(i,1);
        if(tutorialHits>=50){
          alert("–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ! üéâ");
        }
      }
    }
  });
};
</script>

</body>
</html>
